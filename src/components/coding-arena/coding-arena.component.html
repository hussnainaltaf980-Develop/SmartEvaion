
<div class="h-[calc(100vh-4rem)] flex flex-col animate-fade-in text-text-primary">
  @if(showConfetti()) {
    <app-confetti></app-confetti>
  }
  <!-- Header -->
  <header class="flex items-center justify-between p-4 border-b border-border-primary bg-surface/50 shrink-0">
    <h1 class="text-2xl font-bold">Coding Arena</h1>
    <div class="flex items-center gap-4 bg-surface px-4 py-2 rounded-lg border border-border-primary">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-secondary-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
        <span class="text-lg font-mono font-semibold">{{ timerDisplay() }}</span>
    </div>
  </header>

  <!-- Main Content -->
  <div class="flex-grow grid grid-cols-1 lg:grid-cols-12 gap-4 p-4 overflow-hidden">

    <!-- Left Panel: Problem List -->
    <div class="lg:col-span-3 flex flex-col bg-surface/50 rounded-2xl border border-border-primary overflow-hidden">
        <h2 class="text-lg font-semibold p-4 border-b border-border-primary shrink-0">Problems</h2>
        <div class="flex-grow overflow-y-auto custom-scrollbar">
          @for(problem of problems(); track problem.id) {
            <button (click)="selectProblem(problem)" class="w-full text-left p-4 hover:bg-surface transition-colors flex justify-between items-center" [class.bg-primary-accent/20]="selectedProblem()?.id === problem.id">
              <div>
                <p class="font-semibold">{{ problem.title }}</p>
              </div>
              <span class="px-2 py-1 text-xs font-bold rounded-full"
                    [class.bg-green-500/20]="problem.difficulty === 'Easy'" [class.text-green-300]="problem.difficulty === 'Easy'"
                    [class.bg-yellow-500/20]="problem.difficulty === 'Medium'" [class.text-yellow-300]="problem.difficulty === 'Medium'"
                    [class.bg-red-500/20]="problem.difficulty === 'Hard'" [class.text-red-300]="problem.difficulty === 'Hard'">
                {{ problem.difficulty }}
              </span>
            </button>
          }
        </div>
    </div>

    <!-- Center Panel: Editor -->
    <div class="lg:col-span-5 flex flex-col bg-gray-900 rounded-2xl border border-border-primary overflow-hidden">
        <div class="p-4 bg-surface/80 border-b border-border-primary">
            <h2 class="text-xl font-bold">{{ selectedProblem()?.title }}</h2>
        </div>
        <div class="flex-grow relative">
            <app-code-editor [initialCode]="userCode()" (codeChange)="updateCode($event)"></app-code-editor>
        </div>
        <div class="p-3 bg-surface/80 border-t border-border-primary flex justify-end">
            <button (click)="handleSubmit()" [disabled]="isRunning()" class="bg-gradient-to-r from-primary-accent to-secondary-accent hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed text-bg-primary font-bold py-2 px-6 rounded-lg transition-opacity flex items-center gap-2">
                 @if(isRunning()) {
                    <div class="w-5 h-5 border-2 border-bg-primary border-t-transparent rounded-full animate-spin"></div>
                    <span>Running...</span>
                 } @else {
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" /></svg>
                    <span>Run & Submit</span>
                 }
            </button>
        </div>
    </div>

    <!-- Right Panel: Description / Test Cases -->
    <div class="lg:col-span-4 flex flex-col bg-surface/50 rounded-2xl border border-border-primary overflow-hidden">
        <div class="flex border-b border-border-primary shrink-0">
            <button (click)="rightPanelView.set('description')" class="flex-1 p-3 font-semibold transition-colors" [class.bg-surface]="rightPanelView() === 'description'" [class.text-primary-accent]="rightPanelView() === 'description'">Description</button>
            <button (click)="rightPanelView.set('testCases')" class="flex-1 p-3 font-semibold transition-colors" [class.bg-surface]="rightPanelView() === 'testCases'" [class.text-primary-accent]="rightPanelView() === 'testCases'">Test Cases</button>
        </div>
        <div class="flex-grow overflow-y-auto custom-scrollbar p-4">
            @switch (rightPanelView()) {
                @case ('description') {
                    @if(selectedProblem(); as problem) {
                        <div class="prose prose-invert prose-sm text-text-secondary max-w-none">
                             <!-- Render Markdown Description -->
                             <div [innerHTML]="problem.description | markdown"></div>
                            
                            <h3 class="text-text-primary mt-4">Examples:</h3>
                            @for(example of problem.examples; track $index) {
                                <div class="bg-surface p-3 rounded-lg border border-border-primary mb-3">
                                    <p><strong>Input:</strong> <code>{{ example.input }}</code></p>
                                    <p><strong>Output:</strong> <code>{{ example.output }}</code></p>
                                    @if(example.explanation) {
                                      <p><strong>Explanation:</strong> {{ example.explanation }}</p>
                                    }
                                </div>
                            }

                            <h3 class="text-text-primary">Constraints:</h3>
                            <ul>
                                @for(constraint of problem.constraints; track $index) {
                                    <li><code>{{ constraint }}</code></li>
                                }
                            </ul>
                        </div>
                    }
                }
                @case ('testCases') {
                    @if(isRunning()) {
                       <div class="flex items-center justify-center h-full">
                         <div class="flex flex-col items-center gap-2">
                           <div class="w-8 h-8 border-4 border-primary-accent border-t-transparent rounded-full animate-spin"></div>
                           <p class="text-text-secondary">Running tests...</p>
                         </div>
                       </div>
                    } @else if (submissionResult(); as result) {
                        <div class="space-y-3">
                            @if(result.success) {
                                <div class="p-4 bg-green-500/20 border border-green-400/30 rounded-lg text-green-300">
                                    <h3 class="font-bold flex items-center gap-2">
                                      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM3.857 9.309a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" /></svg>
                                      All Passed!
                                    </h3>
                                </div>
                            } @else {
                                <div class="p-4 bg-red-500/20 border border-red-400/30 rounded-lg text-red-300">
                                    <h3 class="font-bold">Failed</h3>
                                    <p class="text-sm">{{ result.message }}</p>
                                </div>
                            }

                            @for(caseResult of result.results; track caseResult.testCaseIndex) {
                                <div class="bg-black/30 rounded-lg border overflow-hidden" 
                                     [class.border-green-500/40]="caseResult.passed" 
                                     [class.border-red-500/40]="!caseResult.passed">
                                    <div class="px-3 py-2 bg-surface/50 border-b border-white/5 flex items-center justify-between">
                                        <span class="font-semibold text-sm text-white">Test Case {{ caseResult.testCaseIndex + 1 }}</span>
                                        <span class="text-xs font-bold px-2 py-0.5 rounded"
                                              [class.bg-green-500/20]="caseResult.passed" [class.text-green-300]="caseResult.passed"
                                              [class.bg-red-500/20]="!caseResult.passed" [class.text-red-300]="!caseResult.passed">
                                            {{ caseResult.passed ? 'PASSED' : 'FAILED' }}
                                        </span>
                                    </div>
                                    <div class="p-3 space-y-3 text-xs font-mono">
                                        <div>
                                            <span class="text-text-muted block mb-1 uppercase tracking-wider text-[10px]">Input</span>
                                            <pre class="bg-black/40 p-2 rounded text-blue-200 overflow-x-auto">{{ formatValue(caseResult.input) }}</pre>
                                        </div>
                                        <div class="grid grid-cols-2 gap-3">
                                            <div>
                                                <span class="text-text-muted block mb-1 uppercase tracking-wider text-[10px]">Expected</span>
                                                <pre class="bg-black/40 p-2 rounded text-green-300 overflow-x-auto">{{ formatValue(caseResult.expected) }}</pre>
                                            </div>
                                            