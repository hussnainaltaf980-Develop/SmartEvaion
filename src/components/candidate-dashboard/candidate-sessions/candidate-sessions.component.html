
<div class="animate-fade-in space-y-8">
  <div>
    <h1 class="text-4xl font-bold text-text-primary">Interview Sessions</h1>
    <p class="text-text-secondary mt-2 text-lg">Start a new practice session or review your past performance.</p>
  </div>

  <!-- Start New Session Section -->
  <section aria-labelledby="new-session-heading" class="bg-surface/50 border border-border-primary rounded-2xl p-6">
    <h2 id="new-session-heading" class="text-2xl font-bold text-text-primary mb-4">Choose an Interview Template</h2>
    
    @if (templates().length > 0) {
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        @for (template of templates(); track template.id) {
          <div class="flip-card-container group" tabindex="0" role="button" (keyup.enter)="startInterview(template)">
            <div class="flip-card">
              <!-- Front of the card -->
              <div class="flip-card-front bg-surface border border-border-primary p-6 flex flex-col justify-between shadow-lg">
                <div>
                  <span class="px-2 py-1 text-xs font-bold rounded-full capitalize"
                      [class.bg-blue-500/20]="template.type === 'technical'" [class.text-blue-300]="template.type === 'technical'"
                      [class.bg-purple-500/20]="template.type === 'behavioral'" [class.text-purple-300]="template.type === 'behavioral'"
                      [class.bg-yellow-500/20]="template.type === 'situational'" [class.text-yellow-300]="template.type === 'situational'"
                      [class.bg-gray-500/20]="template.type === 'general'" [class.text-gray-300]="template.type === 'general'">
                    {{ template.type }}
                  </span>
                  <h3 class="text-xl font-bold text-text-primary mt-3">{{ template.jobTitle }}</h3>
                  <p class="text-text-secondary text-sm">{{ template.experienceLevel }} Level</p>
                </div>
                <p class="text-text-muted mt-4 text-sm">{{ template.questions.length }} Questions</p>
              </div>
              <!-- Back of the card -->
              <div class="flip-card-back bg-gradient-to-br from-primary-accent to-secondary-accent p-6">
                <p class="text-bg-primary font-semibold text-center mb-4">Ready to start?</p>
                <button (click)="startInterview(template)" class="bg-white text-primary-accent font-bold py-2 px-6 rounded-full transition-transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-white/50" aria-label="Start session for {{ template.jobTitle }}">
                  Start Session
                </button>
              </div>
            </div>
          </div>
        }
      </div>
    } @else {
      <app-empty-state
        title="No Templates Available"
        message="We couldn't find any interview templates. Please check back later or contact your administrator."
        icon='<svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>'
      ></app-empty-state>
    }
  </section>

  <!-- Past Sessions -->
  <section aria-labelledby="past-sessions-heading" class="bg-surface/50 border border-border-primary rounded-2xl p-6">
    <h2 id="past-sessions-heading" class="text-2xl font-bold text-text-primary mb-4">Past Sessions</h2>
    
    @if (pastSessions().length > 0) {
      <div class="overflow-x-auto">
        <table class="w-full text-left text-sm" role="table">
          <thead class="border-b border-border-primary text-text-muted">
            <tr>
              <th class="p-3" scope="col">Title</th>
              <th class="p-3" scope="col">Date</th>
              <th class="p-3" scope="col">Score</th>
              <th class="p-3" scope="col">Status</th>
              <th class="p-3" scope="col"><span class="sr-only">Actions</span></th>
            </tr>
          </thead>
          <tbody>
            @for (session of pastSessions(); track session.id) {
              <tr class="border-b border-border-primary/50 hover:bg-surface/50 transition-colors">
                <td class="p-3 font-semibold text-text-primary">{{ session.jobTitle }}</td>
                <td class="p-3">{{ session.completedAt ? (session.completedAt | date:'medium') : (session.startedAt | date:'medium') }}</td>
                <td class="p-3 font-bold" [class.text-green-400]="(session.overallScore ?? 0) >= 7" [class.text-yellow-400]="(session.overallScore ?? 0) >= 5 && (session.overallScore ?? 0) < 7" [class.text-red-400]="(session.overallScore ?? 0) < 5">
                  {{ session.overallScore?.toFixed(1) ?? 'N/A' }}
                </td>
                <td class="p-3">
                  <span class="px-2 py-1 text-xs font-bold rounded-full capitalize"
                    [class.bg-green-500/20]="session.status === 'approved'" [class.text-green-300]="session.status === 'approved'"
                    [class.bg-yellow-500/20]="session.status === 'pending'" [class.text-yellow-300]="session.status === 'pending'"
                    [class.bg-red-500/20]="session.status === 'rejected'" [class.text-red-300]="session.status === 'rejected'">
                    {{ session.status }}
                  </span>
                </td>
                <td class="p-3 text-right">
                  <button class="text-primary-accent hover:underline focus:outline-none focus:ring-2 focus:ring-primary-accent rounded px-2" [disabled]="!session.completedAt" [attr.aria-label]="'View report for ' + session.jobTitle">View Report</button>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    } @else {
      <app-empty-state
        title="No Sessions Yet"
        message="You haven't completed any interview sessions yet. Pick a template above to get started!"
        icon='<svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>'
      ></app-empty-state>
    }
  </section>
</div>

<!-- Start Session Confirmation Dialog -->
@if (showStartDialog(); as template) {
  <div class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in" role="dialog" aria-modal="true" aria-labelledby="dialog-title" (click)="cancelStart()">
    <div class="bg-surface border border-border-primary rounded-2xl shadow-2xl w-full max-w-md m-4" (click)="$event.stopPropagation()">
      <div class="p-6">
        <h3 id="dialog-title" class="text-xl font-bold text-text-primary mb-2">Start Interview Session</h3>
        <p class="text-text-secondary mb-4">You are about to start the "{{ template.jobTitle }}" interview.</p>
        <label for="sessionTitle" class="block text-sm font-medium text-text-secondary mb-2">Session Title</label>
        <input id="sessionTitle" type="text" [(ngModel)]="sessionTitle" class="w-full p-2 bg-input-bg border border-input-border rounded-lg text-text-primary focus:ring-2 focus:ring-primary-accent focus:outline-none transition-colors" placeholder="e.g., My Practice Session">
      </div>
      <div class="bg-surface/50 p-4 flex justify-end gap-4 rounded-b-2xl">
        <button (click)="cancelStart()" class="bg-transparent border border-input-border hover:bg-surface/50 text-text-primary font-bold py-2 px-4 rounded-full transition-all focus:outline-none focus:ring-2 focus:ring-text-primary">
          Cancel
        </button>
        <button (click)="confirmStart()" [disabled]="isStarting() || !sessionTitle()" class="bg-gradient-to-r from-primary-accent to-secondary-accent hover:opacity-90 disabled:opacity-50 text-bg-primary font-bold py-2 px-4 rounded-full transition-all flex items-center justify-center w-36 focus:outline-none focus:ring-2 focus:ring-primary-accent">
          @if(isStarting()) {
            <div class="w-5 h-5 border-2 border-bg-primary border-t-transparent rounded-full animate-spin"></div>
          } @else {
            <span>Confirm & Start</span>
          }
        </button>
      </div>
    </div>
  </div>
}
